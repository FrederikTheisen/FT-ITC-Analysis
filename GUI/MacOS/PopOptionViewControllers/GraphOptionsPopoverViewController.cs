// This file has been autogenerated from a class added in the UI designer.

using System;

using Foundation;
using AppKit;
using System.Text.RegularExpressions;

namespace AnalysisITC
{
	public partial class GraphOptionsPopoverViewController : NSViewController
	{
		public GraphOptionsPopoverViewController (IntPtr handle) : base (handle)
		{
		}

        public override void ViewWillAppear()
        {
            base.ViewWillAppear();
            var unitnum = FinalFigureGraphView.EnergyUnit switch
            {
                EnergyUnit.KiloJoule => 0,
                EnergyUnit.Joule => 0,
                EnergyUnit.MicroCal => 1,
                EnergyUnit.Cal => 1,
                EnergyUnit.KCal => 1,
                _ => 0,
            };
            EnergyUnitControl.SelectSegment(unitnum);

            WidthLabel.StringValue = FinalFigureGraphView.Width.ToString("F1") + " cm";
            HeightLabel.StringValue = FinalFigureGraphView.Height.ToString("F1") + " cm";

            SanitizeTicks.State = FinalFigureGraphView.SanitizeTicks ? NSCellStateValue.On : NSCellStateValue.Off;
        }

        partial void ControlChanged(NSObject sender)
        {
            if (WidthLabel.StringValue.Length > 0)
            {
                string widthstring = Regex.Replace(WidthLabel.StringValue, "[^0-9.]", "");

                if (float.TryParse(widthstring, out var w))
                {
                    FinalFigureGraphView.Width = w;
                }
            }

            if (WidthLabel.StringValue.Length > 0)
            {
                string heightstring = Regex.Replace(HeightLabel.StringValue, "[^0-9.]", "");

                if (float.TryParse(heightstring, out var h))
                {
                    FinalFigureGraphView.Height = h;
                }
            }

            FinalFigureGraphView.SanitizeTicks = SanitizeTicks.State == NSCellStateValue.On;

            AppSettings.EnergyUnit = EnergyUnitControl.SelectedSegment == 0 ? EnergyUnit.KiloJoule : EnergyUnit.KCal;

            FinalFigureGraphView.Invalidate();
        }
    }
}
